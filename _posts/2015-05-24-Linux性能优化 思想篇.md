---
layout: post
title: "linux perf thought"
categories:性能优化
- 
tags:Linux 
- 


---

## Linux性能优化 思想篇 ##
###  软硬结合 ###
软件灵活，硬件高效，软硬结合就像双剑合壁，威力巨大；具体在网络设备中交换机就是一个很好的例子：通常由CPU完成协议的处理，下发转发表项到芯片，由芯片完成报文的转发，在这种思路下才会cisco，H3C，Huawei的大容量的交换机；如果完成交给CPU来处理成本很高，而且在有技术下很难完成那么大的交换容量。在这种情况对于软件上来说基本不需要优化，本文后面的优化是针对软转的优化； 
### 分离 ###
控制与转发分离 由控制平面维护转发表项，转发平面根据表项完成转发
### 针对性优化 ###
性能优化一定要指定优化场景，例如对于收包优化针对不同的接入方式，不同报文类型；
### 快慢结合，先慢后快###
对于交换机与路由机这种网络转发设备，通过首包建流，后续报文匹配流实现快慢结合提高报文转发效率；

### 缓存 ###
缓存大法好，在现在各种系统与应用中随处可见，例如
1. cpu的cache 
2. cdn
### do more with less ###
性能优化大体就是开源与节流，do more with less需要考虑如何提高cpu，存储，网络的利用效率

### 预处理 ###
兵马未动粮草先行 例如在报文发送针对流准备链路层头，避免发送报文再逐个字段填充，作到一次性完成报文贴头处理
### 二八原则 ###
在具体的系统性能优化过程刚开始投入20%可以使取得整个优化成果的80%，而最后的20%需要花费80%的时间来完成，而且涉及的挑战会更多，更有难度，所以优化过程越到后面越难，需要良好的心态与意志
### 无profile，不优化 ###
优化一定要有一套profile方法，profile以下几个方面的作用：

1. profile建立一个性能基线，有利于优化过程中比较与参考
2. profile查找系统的瓶颈，在一个大型的系统查找到性能瓶颈是一件很有挑战的事情,通过profile有利于快速定位瓶颈
3. profile评估优化结果，对每一个优化点有一个数字化清晰的记录
4. profile指导优化的方向




